<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Interactive Black History Tube Map</title>
    <meta name="description" content="An interactive way to navigate the Black History Tube Map." />
    <link rel="stylesheet" href="https://rawcdn.githack.com/nextapps-de/winbox/0.2.0/src/css/winbox.css" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="app">
      <div class="app-header pt-2 pb-2">
        <div class="app-header-left">
          <div class="app-header-item pl-2 pr-1">
            <div class="app-header-logo">Interactive Black History Tube Map</div>
          </div>
          <div class="app-header-item pt-1 d-pt-0 pl-1 pr-2">
            <div class="app-header-toggle-labels">
              <label><input id="input-toggle-labels" name="toggle-labels" type="checkbox" /> Show Stations Names</label>
            </div>
          </div>
        </div>
        <div class="app-header-right">
          <div class="app-header-item pl-2 pr-2">
            <!-- button type="button">Filters</button -->
          </div>
        </div>
      </div>
      <div class="app-content">
        <div id="app-map"></div>
      </div>
      <div id="wx-station-thumbnail"></div>
      <div id="wx-info" class="app-footer in-active">
        <div class="app-footer-inner pb-3">
          <div class="app-footer-toolbar">
            <button id="wx-info-close" class="btn">close</button>
          </div>
          <div class="app-footer-list">
            <div class="app-footer-list-item pt-1 pb-1 pl-2 pr-2">
              <h3 class="app-footer-list-item-title mt-1 mb-1">
                About Project
              </h3>
              <div class="app-footer-list-item-content">
                <p class="mt-1 mb-1">
                  The <a href="https://blackculturalarchives.org/shop/black-history-tube-map" target="_blank" rel="noopener noreferrer" title="Link to Official Black History Tube Map">Black History Tube Map</a>
                  was released by Transport of London in October 2021 to celebrate the 40th anniversary of the Black Cultural Archives.
                  The map was researched and designed by historian <a href="https://twitter.com/LondonLabrish">Kelly Foster</a>.
                </p>
                <p class="mt-1 mb-1">
                  The <strong>Interactive Black History Tube Map</strong> is a personal research project to learn more about the 270 names
                  listed on the original map. The project was started in October 2021 and release late November 2021.
                </p>
                <p class="mt-1 mb-1">
                  This project is not affliated, not in collaboration nor representative of TFL, Black Cultural Archives or the original team who produced the map. This project also does not guarantee
                  accurate representation, past or future, of the source material. Any issues should be directed to the project's github repository.
                  All rights are reserved to their respective copyright holders.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="app-footer-display p-2">
          <button id="wx-info-open" class="btn">About this site</button>
        </div>
      </div>
    </div>
    <script type="module">
      /**
       * Allows switching from people names to station names on the map.
       */
      import { fromEvent } from 'https://cdn.skypack.dev/rxjs';
      import { dispatch } from './actions/index.js';
      import { ACTIONS } from './features/TubeMap/index.js';
      let labelCursor = 0;
      const inputToggleLabels = document.querySelector('#input-toggle-labels');
      fromEvent(inputToggleLabels, 'change')
        .subscribe(() => {
          labelCursor = labelCursor > 0 ? 0 : 1;
          dispatch({ type: ACTIONS.TOGGLE_LABELS, payload: labelCursor, error: null });
        })
    </script>
    <script type="module">
      /**
       * Renders the tube map
       */
      import { ofType } from './actions/index.js';
      import { TubeMap, ACTIONS } from './features/TubeMap/index.js';

      const el = document.querySelector('#app-map');
      const tubeMap = new TubeMap({ el });
      await tubeMap.init();
      tubeMap.render();

      const resizerObserver = new ResizeObserver((e) => tubeMap.resize());
      resizerObserver.observe(el);

      ofType(ACTIONS.TOGGLE_LABELS)
        .subscribe(event => {
          tubeMap.setLabelsCursor(event.payload);
          tubeMap.renderLabels();
        });
    </script>
    <script type="module">
      /**
       * renders a thumbnail view which is mobile only.
       */
      import { fromEvent } from 'https://cdn.skypack.dev/rxjs';
      import { stationsKeyByCode } from './datasets/index.js'
      import { ofType, dispatch } from './actions/index.js';
      import { ACTIONS } from './features/Stations/index.js';
      import Thumbnail from './features/Stations/components/Thumbnail.js';
      import DetailModal from './features/Stations/components/DetailModal.js';

      const el = document.querySelector('#wx-station-thumbnail');

      let selectedStation = null;
      ofType(ACTIONS.OPEN_STATION)
        .filter(event => event.meta.isMobileViewport)
        .subscribe(event => {
          if (event.error) return;
          selectedStation = {
            ...event.payload,
            station: stationsKeyByCode[event.payload.station_code],
          };
          el.innerHTML = Thumbnail(selectedStation);
        });

      fromEvent(el, 'click')
        .subscribe(() => {
          if (selectedStation) DetailModal(selectedStation);
        });
    </script>
    <script type="module">
      /**
       * handles the people modal when user clicks on a name or station on
       * the map
       */
      import { ofType } from './actions/index.js';
      import { ACTIONS } from './features/Stations/index.js';
      import DetailModal from './features/Stations/components/DetailModal.js';

      ofType(ACTIONS.OPEN_STATION)
        .filter(event => !event.meta.isMobileViewport)
        .subscribe(event => {
          DetailModal(event.payload);
        });
    </script>
    <script type="module">
      /**
       * Handles the App info widget
       */
      import { AppInfo } from './features/AppInfo/index.js';
      AppInfo({
        el: document.querySelector('#wx-info'),
        openButton: document.querySelector('#wx-info-open'),
        closeButton: document.querySelector('#wx-info-close'),
      });
    </script>
  </body>
</html>
</html>